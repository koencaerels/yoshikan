{# The 'recursive' macro, for inserting one menu item. If it has a submenu, it
   invokes itself to insert the items of the submenus. #}
{% macro display_menu_item(item, loop, withsubmenus) %}
    {% from _self import display_menu_item %}
    {% apply spaceless %}
        {% set with_submenu = withsubmenus and item.submenu is not empty %}
        {% if item.uri != '/' %}
            <li><a href="{{ item.uri }}" class="{{ loop.first ? ' first' -}}{{ loop.last ? ' last' -}}{{ item|current ? ' active' }}">
                    {% if item.class != '' %}<i class="{{ item.class }}"></i>{% endif %}
                    {{- item.label -}}
                </a>
        {% else %}
            <li>
                <a href="#">
                    {% if item.class != '' %}<i class="{{ item.class }}"></i>{% endif %}
                    {{- item.label -}}
                </a>
        {% endif %}

        {% if with_submenu %}
            <ul class="sub-menu drop-shadow-lg">
                {% for submenu in item.submenu %}
                    {{ display_menu_item(submenu, loop, true) }}
                {% endfor %}
            </ul>
        {% endif %}

        </li>

    {% endapply %}
{% endmacro %}

{# Make the macro available for use #}
{% from _self import display_menu_item %}

{% for item in menu %}
    {% if item.label is defined %}
        {{ display_menu_item(item, loop, withsubmenus) }}
    {% endif %}
{% endfor %}


{##}
{#                    <a href="{{ item.uri }}" title='{{ item.title }}' > #}
{#            {{- item.label -}} #}
{#        </a> #}
